---
- name: bind | Install deb packages
  package:
    pkg:  "{{ item }}"
    state: installed
  with_items: deb_packages
  when: ansible_os_family == "Debian"

- name: bind | Install rpm packages
  package:
    pkg:  "{{ item }}"
    state: installed
  with_items: rpm_packages
  when: ansible_os_family == "RedHat"

- name: Add log directory
  file:
    path: "{{ item }}"
    state: directory
    owner: bind
    group: bind
    mode: 0755
  with_items:
    - /var/log/bind
    - /etc/bind

- name: Update named options
  template:
    src: named.conf.options.j2
    dest: /etc/bind/named.conf.options
  register: bind_setup

- name: Update rndc key
  template:
    src: rndc.key.j2
    dest: /etc/bind/rndc.key
    mode: 0644

- name: Enable bind systemd
  service:
    name: bind9
    state: started
    enabled: yes

- name: Restart bind when config changed
  service:
    name: bind9
    state: restarted
  when: bind_setup.changed

